generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                    String                  @id @default(uuid()) @db.Uuid
  email                 String                  @unique
  password              String
  created_at            DateTime                @default(now())
  xata_createdat        DateTime                @default(now()) @db.Timestamptz(6)
  xata_updatedat        DateTime                @default(now()) @updatedAt @db.Timestamptz(6)
  xata_id               String                  @unique @default(dbgenerated("('rec_'::text || (xata_private.xid())::text)"))
  xata_version          Int                     @default(0)
  refresh_token         String?
  Notification          Notification[]
  Progress              Progress[]
  StudyPlan             StudyPlan[]
  UserFlashcardProgress UserFlashcardProgress[]
}

model Notification {
  id             String   @id @default(uuid()) @db.Uuid
  user_id        String   @db.Uuid
  send_at        DateTime @default(now())
  message        String
  xata_createdat DateTime @default(now()) @db.Timestamptz(6)
  xata_updatedat DateTime @default(now()) @updatedAt @db.Timestamptz(6)
  xata_id        String   @unique @default(dbgenerated("('rec_'::text || (xata_private.xid())::text)"))
  xata_version   Int      @default(0)
  User           User     @relation(fields: [user_id], references: [id])
}

model Progress {
  id               String   @id @default(dbgenerated("('rec_'::text || (xata_private.xid())::text)"))
  user_id          String   @db.Uuid
  completed_topics Int
  accuracy_rate    Float
  time_spent       Int
  updated_at       DateTime @updatedAt
  xata_id          String   @unique @default(dbgenerated("('rec_'::text || (xata_private.xid())::text)"))
  xata_version     Int      @default(0)
  xata_createdat   DateTime @default(now()) @db.Timestamptz(6)
  xata_updatedat   DateTime @default(now()) @updatedAt @db.Timestamptz(6)
  subject_id       String   @db.Uuid
  Subject          Subject  @relation(fields: [subject_id], references: [id])
  User             User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, subject_id], name: "user_id_subject_id")
  @@index([user_id])
}

model Subject {
  id             String      @id @default(uuid()) @db.Uuid
  name           String
  xata_createdat DateTime    @default(now()) @db.Timestamptz(6)
  xata_updatedat DateTime    @default(now()) @updatedAt @db.Timestamptz(6)
  xata_id        String      @unique @default(dbgenerated("('rec_'::text || (xata_private.xid())::text)"))
  xata_version   Int         @default(0)
  Progress       Progress[]
  StudyPlans     StudyPlan[]
  Topics         Topic[]
}

model Topic {
  id             String      @id @default(uuid()) @db.Uuid
  subject_id     String      @db.Uuid
  name           String
  xata_createdat DateTime    @default(now()) @db.Timestamptz(6)
  xata_updatedat DateTime    @default(now()) @updatedAt @db.Timestamptz(6)
  xata_id        String      @unique @default(dbgenerated("('rec_'::text || (xata_private.xid())::text)"))
  xata_version   Int         @default(0)
  Flashcard      Flashcard[]
  PlanTopics     PlanTopic[]
  Subject        Subject     @relation(fields: [subject_id], references: [id])
}

model StudyPlan {
  id             String      @id @default(uuid()) @db.Uuid
  user_id        String      @db.Uuid
  subject_id     String      @db.Uuid
  xata_createdat DateTime    @default(now()) @db.Timestamptz(6)
  xata_updatedat DateTime    @default(now()) @updatedAt @db.Timestamptz(6)
  xata_id        String      @unique @default(dbgenerated("('rec_'::text || (xata_private.xid())::text)"))
  xata_version   Int         @default(0)
  topic_ids      String[]    @db.Uuid
  PlanTopics     PlanTopic[]
  Subject        Subject     @relation(fields: [subject_id], references: [id])
  User           User        @relation(fields: [user_id], references: [id])
}

model PlanTopic {
  id             String    @id @default(uuid()) @db.Uuid
  study_plan_id  String    @db.Uuid
  topic_id       String    @db.Uuid
  name           String
  status         String    @default("PENDING")
  xata_createdat DateTime  @default(now()) @db.Timestamptz(6)
  xata_updatedat DateTime  @default(now()) @updatedAt @db.Timestamptz(6)
  xata_id        String    @unique @default(dbgenerated("('rec_'::text || (xata_private.xid())::text)"))
  xata_version   Int       @default(0)
  StudyPlan      StudyPlan @relation(fields: [study_plan_id], references: [id])
  Topic          Topic     @relation(fields: [topic_id], references: [id])
}

model Flashcard {
  id                    String                  @id @default(uuid()) @db.Uuid
  topic_id              String                  @db.Uuid
  question              String
  xata_createdat        DateTime                @default(now()) @db.Timestamptz(6)
  xata_updatedat        DateTime                @default(now()) @db.Timestamptz(6)
  xata_id               String                  @unique @default(dbgenerated("('rec_'::text || (xata_private.xid())::text)"))
  xata_version          Int                     @default(0)
  answers               Answer[]
  Topic                 Topic                   @relation(fields: [topic_id], references: [id])
  UserFlashcardProgress UserFlashcardProgress[]
}

model Answer {
  id             String    @id @default(uuid()) @db.Uuid
  flashcard_id   String    @db.Uuid
  text           String
  isCorrect      Boolean
  xata_createdat DateTime  @default(now()) @db.Timestamptz(6)
  xata_updatedat DateTime  @default(now()) @db.Timestamptz(6)
  xata_id        String    @unique @default(dbgenerated("('rec_'::text || (xata_private.xid())::text)"))
  xata_version   Int       @default(0)
  Flashcard      Flashcard @relation(fields: [flashcard_id], references: [id])
}

model UserFlashcardProgress {
  xata_createdat DateTime  @default(now()) @db.Timestamptz(6)
  xata_updatedat DateTime  @default(now()) @db.Timestamptz(6)
  xata_id        String    @unique @default(dbgenerated("('rec_'::text || (xata_private.xid())::text)"))
  xata_version   Int       @default(0)
  id             String    @id @default(uuid()) @db.Uuid
  user_id        String    @db.Uuid
  flashcard_id   String    @db.Uuid
  interval       Int       @default(1)
  repetition     Int       @default(0)
  ef             Float     @default(2.5)
  nextReview     DateTime  @default(now())
  time_spent     Int
  updated_at     DateTime  @updatedAt
  Flashcard      Flashcard @relation(fields: [flashcard_id], references: [id])
  User           User      @relation(fields: [user_id], references: [id])

  @@unique([user_id, flashcard_id])
  @@index([user_id])
}
